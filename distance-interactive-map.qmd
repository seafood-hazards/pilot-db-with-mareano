---
title: "Interactive Map of Core Locations"
subtitle: Interactive map to view sediment core locations with meta information
---

::: {.callout-note}
## Note on Distance Accuracy

Calculated distances represent the shortest Euclidean path to the nearest coastline geometry (GSHHG dataset). 

While the data is projected (EPSG:3035) to minimize distortion at high latitudes, please interpret these values as **estimates**. In areas with complex topography—such as narrow fjords or dense archipelagos—the resolution of the coastline vector data may result in minor deviations from real-world measurements.
:::

::: {.callout-note}
### Note on Location Name Accuracy
Location names from geographic coordinates are **algorithmic estimates** based on geometric proximity. They may differ from historical logbooks or specific political definitions of maritime borders.
:::

## Interactive Map

The map below displays the spatial distribution of sediment cores. The markers are color-coded based on their distance from the nearest Norwegian coastline.

**How to use this map:**

*   **Zoom and Pan** to explore specific coastal areas or offshore regions.
*   **Click the Globe icon <i class="fas fa-earth-europe"></i> ** to reset the view.
*   **Filter** the data by toggling distance categories in the top-right menu (e.g., uncheck boxes to hide specific ranges).
*   Use the **Legend** in the bottom right to interpret the color coding.
*   **Hover** over a point to quickly identify the **Cruise ID** and **Core ID**.
*   **Click** on a marker to view exact coordinates, distance to shore (in km), and location names.

```{r}
#| column: page       
#| fig-height: 7

library(leaflet)
library(viridis)
library(dplyr)
library(sf)

# 1. Load Data
points_web <- readRDS(".data/points_web.Rds")

# 2. Define Default View 
home_lat <- 68
home_lng <- 15
home_zoom <- 4

# 3. Create Palette
pal <- colorFactor(palette = "turbo", domain = points_web$Distance)

# 4. Initialize Map
map <- leaflet(points_web) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  setView(lng = home_lng, lat = home_lat, zoom = home_zoom)

# 5. Add Points 
dist_groups <- rev(levels(points_web$Distance))

for(group in dist_groups) {
  data_subset <- points_web[points_web$Distance == group, ]
  map <- map %>%
    addCircleMarkers(
      data = data_subset,
      group = group,
      radius = 6,
      color = ~pal(group),
      fillColor = ~pal(group),
      fillOpacity = 0.7,
      weight = 1,
      label = ~paste0("Cruise: ", cruise_id, ", Core: ", core_id),
      popup = ~paste0(
        "<strong>Cruise ID:</strong> ", cruise_id, "<br>",
        "<strong>Core ID:</strong> ", core_id, "<br>",
        "<strong>Latitude:</strong> ", round(ddn, 2), "<br>",
        "<strong>Longitude:</strong> ", round(dde, 2), "<br>",
        "<strong>Distance to Coast:</strong> ", round(dist_to_coast, 1), " km", "<br>",
        "<strong>Country:</strong> ", country, "<br>",
        "<strong>Municipality:</strong> ", municipality, "<br>",
        "<strong>Sea/Ocean Name:</strong> ", sea_name
      )
    )
}

# 6. Add Controls & The Home Button
map %>%
  addLayersControl(
    overlayGroups = dist_groups,
    options = layersControlOptions(collapsed = FALSE)
  ) %>%
  addLegend(
    position = "bottomright",
    pal = pal,
    values = ~Distance,
    title = "Distance to Coast",
    opacity = 1
  ) %>%
  addEasyButton(easyButton(
    icon = "fa-earth-europe",
    title = "Reset View",
    onClick = JS(paste0("function(btn, map){ map.setView([", home_lat, ",", home_lng, "], ", home_zoom, "); }"))
  ))

```
