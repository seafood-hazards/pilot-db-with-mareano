---
title: "Invalid Data"
subtitle: "Correction of invalid data in the original Mareano dataset"
---

The page presents the invalid data identified during the database creation process. Because the database enforces stringent constraints on the data structure, the data must be corrected before it can be imported into the database tables.

```{r}
library(tibble)
library(dplyr)
library(knitr)

invalid_full_ids_examples <- tribble(
  ~`Full ID (icorrect format)`,                    ~`Expected ID`,                 ~`Year`, ~`Number`, ~`Tool`, ~`ID`, ~Issue,
  "2008104R0243GR037c0_Gr-243", "2008104R0243GR037c0_00-01", 2008,           "104",            "GR",             "037",                      "Format incorrect (used 'Gr-243' instead of depth interval)",
  "2009111R0447BC481c0_00-01",  "2009105R0447BC481c0_00-01", 2009,           "105",            "BC",             "481",                      "Wrong cruise number",
  "2011113R0749MC020c3_03-04",  "2011113R0749MC020c0_03-04", 2011,           "113",            "MC",             "020",                      "Used core ID (c3) instead of base (c0)",
  "2020104R2139MC008c1_14-15",  "2020104R2139MC008c1_15-16", 2020,           "104",            "MC",             "8",                        "Incorrect core layer interval"
)

sample_sediment_corrections <- tribble(
  ~`Full ID`,                        ~Action,   ~`Old from`, ~`Old to`, ~`New from`, ~`New to`, ~Comment,
  "2021P2009010_0-2",              "delete",  NA,        NA,  NA,        NA,      "Duplicate entry",
  "2021P2009012_0-2",              "delete",  NA,        NA,  NA,        NA,      "Duplicate entry",
  "2021P2009015_0-2",              "delete",  NA,        NA,  NA,        NA,      "Duplicate entry",
  "2021104R2669MC15c1_9-10",       "fix",  8,        9,     9,         10,      "Correct interval (from/to)",
  "2021115R2770MC17c1_9-10",       "fix",  8,        9,     9,         10,      "Correct interval (from/to)",
  "2021115R2869MC19c1_9-10",       "fix",  8,        9,     9,         10,      "Correct interval (from/to)"
)

element_additions <- tribble(
  ~Parameter, ~Element, ~Method1,              ~Method2,              ~Institute,
  "S_p",      "Sulfur", NA_character_,         NA_character_,         "NGU-Laboratory"
)

cruise_correction_rules <- tribble(
  ~`Cruise No`, ~Action,   ~Reason,
  "26",        "delete",  "Duplicate cruise"
)

```

## Invalid Full IDs — examples

  * **Excel Sheet**: `INORGANIC`
  * **Range**: Column A
  
More than 100 Full IDs were incorrectly generated in the source data. Below are **representative examples** with the corrected values and a short explanation.

```{r}
invalid_full_ids_examples %>%
  kable(caption = "Examples of invalid Full IDs and their corrections.")
```


## Sample and Sediment — row duplication & incorrect intervals

  * **Excel Sheet**: `INORGANIC`
  * **Ranges for duplication**: 
     * 2021P2009010_0-2: A3312:K3312 & A3319:K3319
     * 2021P2009012_0-2: A3313:K3313 & A3328:K3328
     * 2021P2009015_0-2: A3315:K3315 & A3337:K3337
  * **Ranges for invalid depth intervals**: 
     * 2021104R2669MC15c1_9-10: A3487:K3487
     * 2021115R2770MC17c1_9-10: A3509:K3509
     * 2021115R2869MC19c1_9-10: A3532:K3532

The following **rule table** drives deletions of duplicate rows and corrections of invalid depth intervals. These rules are applied during the data standardization step.

```{r}
sample_sediment_corrections %>%
  kable(caption = "Rules applied to Sample and Sediment data.")
```

## Cruise Information — row duplication

  * **Excel Sheet**: `INFO`
  * **Range**: P83:V83

The rule below removes a known duplicate entry from the cruise metadata.

```{r}
cruise_correction_rules %>%
  kable(caption = "Rule applied to cruise metadata.")
```


## Element Definitions — missing entry

  * **Excel Sheet**: `INFO`
  * **Range**: A141:G141

A missing Sulfur row is **added** to ensure completeness of element definitions.

```{r}
element_additions %>%
  kable(caption = "Element definition additions.")
```
