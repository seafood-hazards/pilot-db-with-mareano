---
title: "DB Schema"
subtitle: A proposed database design based on Mareano Chemical Data 
---

The page shows the database schema diagram along with table definitions based on the Mareano dataset.

## DB Schema Diagram
The proposed database design shown in the ER (Entity Relationship) diagram below contains five tables including three meta (entity) tables, one variable (look-up or reference) table, and one fact (measurement) table.

The columns with `PK` in the diagram indicate primary keys of the table, which guarantees unique identifications. All tables are connected by one-to-many relationships.

![](./image/mareano_db.png)

## Cruise Table

The cruise table includes Mareano cruise information and is a parent of the core table.

### Cruise ID

The ID values in the `cruise_id` column are formulated as follows:

> cruise_id: MA-{year}-{cruise_no}

### Table Columns
``` {r}
library(tibble)

cruise_tbl <- tibble(
  `Column Name` = c(
    "cruise_id", "source", "type", "year", "month", "day",
    "cruise_no", "start", "end", "area", "cruise_no2"
  ),
  `Column Type` = c(
    "TEXT", "TEXT", "TEXT", "INTEGER", "INTEGER", "INTEGER",
    "INTEGER", "INTEGER", "INTEGER", "INTEGER", "INTEGER"
  ),
  `NA Allowed` = c(
    FALSE, TRUE, TRUE, TRUE, TRUE, TRUE,
    TRUE, TRUE, TRUE, TRUE, TRUE
  )
)
cruise_tbl
```


## Core Table

The core table includes sediment core information and is a parent of the sample table.

### Core ID

The ID values in the `core_id` column are formulated as follows:

> core_id: {station_no}-{sampling_tool}-{core_name}

The {sampling_tool} part is three characters, padded with zeros, while the {core_name} part is two characters (or "00" if not available).

### Table Columns
``` {r}
core_tbl <- tibble(
  `Column Name` = c(
    "cruise_id", "core_id", "station_no", "sampling_tool",
    "tool_id", "core_name", "dde", "ddn", "mbsl", "dist_to_coast"
  ),
  `Column Type` = c(
    "TEXT", "TEXT", "TEXT", "TEXT",
    "TEXT", "TEXT", "REAL", "REAL", "REAL", "INTEGER"
  ),
  `NA Allowed` = c(
    FALSE, FALSE, TRUE, TRUE,
    TRUE, TRUE, TRUE, TRUE, TRUE, TRUE
  )
)
core_tbl
```

## Sample Table

The sample table includes specific sediment sample intervals and is a child of the core table.

### Sample ID

The ID values in the `sample_id` column are formulated as follows:

> sample_id: {core_name}-{depth_from}-{depth_to}

All parts are two characters, padded with zeros.

### Table Columns
``` {r}
sample_tbl <- tibble(
  `Column Name` = c(
    "cruise_id", "core_id", "sample_id",
    "depth_from", "depth_to",
    "sample_batch_id", "sample_id2"
  ),
  `Column Type` = c(
    "TEXT", "TEXT", "TEXT",
    "INTEGER", "INTEGER",
    "TEXT", "TEXT"
  ),
  `NA Allowed` = c(
    FALSE, FALSE, FALSE,
    TRUE, TRUE,
    TRUE, TRUE
  )
)
sample_tbl
```

## Parameter Table

The parameter table is a look-up table that contains parameter information for the sediment table.

### Table Columns
``` {r}
parameter_tbl <- tibble(
  `Column Name` = c(
    "parameter", "unit", "element",
    "method1", "method2", "institute"
  ),
  `Column Type` = c(
    "TEXT", "TEXT", "TEXT",
    "TEXT", "TEXT", "TEXT"
  ),
  `NA Allowed` = c(
    FALSE, TRUE, TRUE,
    TRUE, TRUE, TRUE
  )
)
parameter_tbl
```

## Sediment Table

The sediment table contains measurements for all parameters. 

### Table Columns
``` {r}
sediment_tbl <- tibble(
  `Column Name` = c(
    "cruise_id", "core_id", "sample_id",
    "parameter", "value", "is_lld"
  ),
  `Column Type` = c(
    "TEXT", "TEXT", "TEXT",
    "TEXT", "REAL", "INTEGER"
  ),
  `NA Allowed` = c(
    FALSE, FALSE, FALSE,
    FALSE, TRUE, TRUE
  )
)
sediment_tbl
```

::: {.callout-note}
The is_lld column indicates if the value is LLD (Lower Level of Detection). For example, if the original value is "<5", the value is set to "5", but is_lld is set to 1 (TRUE) instead of the default 0 (FALSE).
:::
